Test Case ID,Title,Description,Test Steps,Expected Results,Priority,Type,Requirement ID,SQL Validation Query
ETL_CSR_001,Verify DDL â€“ New Columns Added,Validate new RAT history columns are created,Deploy DDL and query metadata tables,Columns exist with correct data types,High,Positive,R1,"SELECT column_name FROM information_schema.columns WHERE table_name IN ('customer_segmentation_input','customer_segmentation') AND column_name IN ('last_ii_rat_segment','last_ii_rat_subsegment','last_ii_rat_customer_exposure_class');"
ETL_CSR_002,Validate LAG Logic for RAT Segment,Verify lag ignore nulls logic,Insert test data with nulls and run ETL,Derived column reflects last non-null RAT,High,Positive,R2,"SELECT customer_id, ii_rat_segment, last_ii_rat_segment, LAG(ii_rat_segment) IGNORE NULLS OVER (PARTITION BY customer_id ORDER BY customer_start_datetime) expected FROM customer_segmentation_input;"
ETL_CSR_003,Validate Partition by Customer,Ensure lag does not cross customers,Load multiple customers and run ETL,Lag calculated per customer only,High,Positive,R3,SELECT COUNT(*) FROM customer_segmentation_input a JOIN customer_segmentation_input b ON a.last_ii_rat_segment=b.ii_rat_segment WHERE a.customer_id<>b.customer_id;
ETL_CSR_004,Validate Ordering by Start Date,Ensure correct chronological lag,Load out-of-order data and run ETL,Lag respects start datetime,Medium,Positive,R4,"SELECT customer_id, customer_start_datetime, ii_rat_segment, last_ii_rat_segment FROM customer_segmentation_input ORDER BY customer_start_datetime;"
ETL_CSR_005,Default Flag Override,Validate default flag override logic,Set default_flag true and run ETL,Segmentation overridden by CS code,High,Positive,R5,SELECT * FROM customer_segmentation WHERE default_flag='Y' AND customer_segmentation_code<>cs_customer_segmentation_code;
ETL_CSR_006,Carry Forward RAT Segment,Use last RAT when current null,Null current RAT and run ETL,Historical RAT applied,High,Positive,R6,SELECT * FROM customer_segmentation WHERE ii_rat_segment IS NULL AND last_ii_rat_segment IS NOT NULL AND customer_segmentation_code<>last_ii_rat_segment;
ETL_CSR_007,Exclude PER and SCO,Ensure exclusions are respected,Set PER/SCO and run ETL,No overwrite occurs,High,Negative,R7,"SELECT * FROM customer_segmentation WHERE customer_segmentation_code IN ('PER','SCO') AND customer_segmentation_code=last_ii_rat_segment;"
ETL_CSR_008,Validate Allowed RAT Values,Reject invalid RAT values,Insert invalid RAT and run ETL,Invalid values ignored,Medium,Negative,R8,"SELECT DISTINCT last_ii_rat_segment FROM customer_segmentation WHERE last_ii_rat_segment NOT IN ('BNK','FIN','FUN','RE','SHI','RE-SME','TOA');"
ETL_CSR_009,Sub-Segmentation Logic,Validate subsegment carry forward,Null subsegment and run ETL,Subsegment derived correctly,Medium,Positive,R9,SELECT * FROM customer_segmentation WHERE ii_rat_subsegment IS NULL AND last_ii_rat_subsegment IS NOT NULL AND customer_subsegmentation_code<>last_ii_rat_subsegment;
ETL_CSR_010,Exposure Class Carry Forward,Validate exposure class continuity,Null exposure class and run ETL,Exposure inherited correctly,High,Positive,R10,SELECT * FROM customer_segmentation WHERE ii_rat_customer_exposure_class IS NULL AND last_ii_rat_customer_exposure_class IS NOT NULL AND customer_exposure_class<>last_ii_rat_customer_exposure_class;
ETL_CSR_011,Data Lineage Validation,Validate source-to-target lineage,Trace RAT fields from source to target,Lineage auditable,High,Data Lineage,R11,"SELECT customer_id, ii_rat_segment, last_ii_rat_segment, customer_segmentation_code FROM customer_segmentation;"
ETL_CSR_012,Regression Validation,Ensure no unintended impact,Compare pre/post ETL outputs,Only expected changes occur,High,Regression,R12,SELECT COUNT(*) FROM customer_segmentation_pre MINUS SELECT COUNT(*) FROM customer_segmentation_post;
ETL_CSR_013,Null Handling Stability,Validate stability with all nulls,Insert fully null record and run ETL,Job completes successfully,Medium,Negative,R13,SELECT * FROM customer_segmentation WHERE customer_id IS NOT NULL;
ETL_CSR_014,Performance Validation,Validate performance on large volumes,Run ETL on high-volume data,Job completes within SLA,Medium,Non-Functional,R14,"SELECT job_name, run_time FROM etl_job_audit WHERE job_name='customersegmentationinputT';"
ETL_CSR_015,Audit & Compliance,Validate audit readiness,Review audit trail and derived fields,Results explainable and traceable,High,Audit,R11,SELECT * FROM customer_segmentation_audit WHERE change_reason IS NOT NULL;
